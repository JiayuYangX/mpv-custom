########
# 界面 #
########

# 窗口
border=yes
no-title-bar
ontop=no
keepaspect=yes
keepaspect-window=no
geometry=1792x1008

osc=no
load-select=no
load-stats-overlay=no
script-opts=stats-persistent_overlay=yes

# OSD
osd-fractions=yes
osd-duration=2000
osd-scale-by-window=yes

# OSD 进度条样式（窗口模式始终显示 osd-bar.lua）
osd-bar-w=100
osd-bar-h=0.4
osd-bar-align-y=1
osd-bar-border-size=0

########
# 播放 #
########

idle=yes
keep-open=yes
save-position-on-quit=yes
watch-later-options=start,edition,volume,aid,vid,sid,secondary-sid

loop-playlist=inf
autocreate-playlist=same
directory-mode=ignore

hr-seek=default
input-ime=no
input-default-bindings=no
input-doubleclick-time=170

########
# 视频 #
########

vo=gpu-next
gpu-context=d3d11
d3d11-flip=yes

# hwdec=auto-copy
hwdec-codecs = h264,hevc,vp8,vp9,av1,ffv1

dither-depth=auto
dither=fruit

########
# 音频 #
########

ao=wasapi
volume=100
volume-max=200
audio-channels=stereo
audio-file-auto=fuzzy
alang=zh,Chinese,chi,chs,sc,zh-hans,zh-cn,zho,cht,tc,zh_hant,zh-tw,zh-hk,eng,en,enUS,en-US,English

########
# 字幕 #
########

sub-auto=fuzzy
slang=zh,Chinese,chi,chs,sc,zh-hans,zh-cn,zho,cht,tc,zh_hant,zh-tw,zh-hk,eng,en,enUS,en-US,English
sub-file-paths=sub;subs;subtitles;字幕
sub-font="微软雅黑"
sub-font-size=40
sub-bold=no
sub-color="#FFFFFF"
sub-outline-size=1.5
sub-outline-color="#000000"
sub-shadow-offset=0
sub-back-color="#000000"

########
# 截图 #
########

screenshot-format=jpg
screenshot-jpeg-quality=100
screenshot-tag-colorspace=no
screenshot-high-bit-depth=no
screenshot-template="~/Pictures/Screenshots/mpv-shot-%{media-title}-%P-%n"

########
# 缓存 #
########

watch-later-dir="~~/cache/watch_later"
watch-later-dir="~~/cache/watch_later"
gpu-shader-cache-dir="~~/cache/shader"
icc-cache-dir="~~/cache/icc"
log-file="~~/cache/mpv.log"


# 以下内容修改自 mpv-config 的配置文件

##################
# 通用参数补充区 #
##################

##⇘⇘以下为常规配置组启用参数，视需求选择使用
#profile=ICC                                  # icc 色彩管理配置组，由操作系统的显示设置指定的 ICC 显示配置文件
profile=Target                                # target 色彩管理配置组，不可与 icc 色彩管理共存
profile=Dither                                # 抖动算法配置组（fruit），效果接近 error-diffusion，耗能较低
#profile=Dither+                              # 抖动算法配置组（error-diffusion），误差扩散的色深抖动算法，效果最好也最耗能
profile=Tscale                                # [启用前须先注释 --tscale=<value>] 时域插值算法，具体参数见下方配置区的同名配置
#profile=Tscale+                              # [启用前须先注释 --tscale=<value>] 备选的时域插值算法，具体参数见下方配置区的同名配置
profile=HQ                                    # 最常用的内置算法配置组
profile=DeBand-low                            # [启用前需先注释 --deband] 预设的去色带方案，具体参数见下方配置区的同名配置，接近 madvr 的 deband 设为 low，使用 low 时已有很好的效果
#profile=DeBand-medium                        # [启用前需先注释 --deband] 备选的去色带方案，具体参数见下方配置区的同名配置，接近 madvr 的 deband 设为 medium
#profile=DeBand-high                          # [启用前需先注释 --deband] 备选的去色带方案，具体参数见下方配置区的同名配置，接近 madvr 的 deband 设为 high
profile=HDR2SDR                               # HDR 映射 SDR 参数配置组
                                              # 此配置组不会影响 HDR 设备下的 HDR 直通配置，需要配置 HDR 直通时无需注释此配置组，会影响 SDR 内容的显示
                                              # HDR 直通下依然有可能应用到此配置组中的动态映射和算法（HDR 画面亮度超出显示器峰值亮度时）
#profile=SDR2HDR                              # SDR 映射 HDR 参数配置组，仅在 HDR 显示模式下有效，不推荐启用。仅限--vo=gpu-next 下可用
#profile=SWscaler                             # 备选的软件缩放方案

## 以下为着色器配置组，可按需启用以下所需任一配置组（这将覆盖上面的--glsl-shaders-append 参数）
profile=NNEDI3+                               # 适用于大多数场景（NNEDI3-64）               ## 理论上 NNEDI3-64 及以上变体具有更好地抑制振铃伪影效果，但耗能量级倍增，视设备性能自行选择是否使用

##############
# 常规配置组 #
##############

##⇘⇘常规配置没有自动触发条件（内置配置组也全为常规配置）
##需要主设置文件中使用 --profile=<profile1,profile2,...> 或多行 --profile=<xxx> 参数激活数个配置

[ICC]
 icc-profile=""
 icc-profile-auto
 icc-intent=0
 icc-force-contrast=1000
 icc-3dlut-size=auto
 icc-cache-dir="~~/cache/icc_cache"

[Target]
 icc-profile=""
 icc-profile-auto=no
 target-prim=auto
 #target-trc=gamma2.2
 #target-peak=203
 target-contrast=auto
 #sdr-adjust-gamma=no
 #treat-srgb-as-power22=no

[Dither]
 dither-depth=auto
 dither=fruit
 dither-size-fruit=6

[Dither+]
 dither-depth=auto
 dither=error-diffusion
 error-diffusion=floyd-steinberg

[Tscale]
 video-sync=display-resample
 #video-sync-max-video-change=5
 interpolation
 #interpolation-preserve=no
 tscale=oversample

[Tscale+]
 video-sync=display-resample
 #video-sync-max-video-change=5
 interpolation
 #interpolation-preserve=no
 tscale=sphinx
 tscale-blur=0.65

[HQ]
 scale=ewa_lanczossharp
 cscale=bilinear
 dscale=catmull_rom
 scale-antiring=0.5
 dscale-antiring=0.5
 linear-upscaling=no
 sigmoid-upscaling=yes
 correct-downscaling=yes
 linear-downscaling=no
 #scaler-resizes-only=no
 deband=no

[DeBand-low]
 profile-desc=DeBand low
 deband-iterations=1
 deband-threshold=48
 deband-range=16
 deband-grain=16

[DeBand-medium]
 profile-desc=deband medium
 deband-iterations=2
 deband-threshold=64
 deband-range=16
 deband-grain=24

[DeBand-high]
 profile-desc=deband high
 deband-iterations=3
 deband-threshold=64
 deband-range=16
 deband-grain=24

[HDR2SDR]
 profile-desc=HDR-SDR 映射参数
 tone-mapping=auto
 #tone-mapping-param=1.0
 #tone-mapping-max-boost=1.0
 gamut-mapping-mode=auto
 hdr-contrast-recovery=0.30
 #hdr-contrast-smoothness=3.5
 hdr-compute-peak=auto
 hdr-peak-percentile=99.995
 hdr-peak-decay-rate=20
 hdr-scene-threshold-low=1.0
 hdr-scene-threshold-high=3.0
 allow-delayed-peak-detect=no

[SDR2HDR]
 profile-desc=SDR 反向映射 HDR 参数
 icc-profile=""
 icc-profile-auto=no
 target-prim=auto
 #target-gamut=dci-p3   # 或 adobe，用于 argb 色域
 target-trc=auto
 target-peak=auto  # --gpu-api=vulkan 下必须指定显示器的峰值亮度值，--gpu-api=d3d11 下默认值会自动获取此信息
 target-colorspace-hint=auto
 inverse-tone-mapping=yes

##⇘⇘备选的软件缩放方案
##在 mpv 内部需要执行格式转换时会用到软件缩放器
[SWscaler]
 profile-desc=软件缩放配置
 sws-allow-zimg=no                  # 优先使用 zimg（通常具有更高质量）而不是 libswscale，默认 yes。ffmpeg 经常出现和 zimg 间的兼容性问题，建议禁用
 sws-scaler=bicublin                # [libswscale] <fast-bilinear|bilinear|bicubic 默认|x|point|area|bicublin|gauss|sinc|lanczos|spline>
                                    # [libswscale] 缩放算法（同时作用于色度平面）
 #sws-fast=yes                      # [libswscale] 以质量为代价优化性能，默认 no
 zimg-scaler-chroma=bicubic         # [zimg] <point|bilinear|bicubic|spline16|spline36|lanczos 默认>
                                    # [zimg] 色度还原算法
 #zimg-scaler-chroma-param-a=1/3    # [zimg] 色度还原算法的子参数，不支持调节的算法不受影响，默认 default
 #zimg-scaler-chroma-param-b=1/3
 zimg-scaler=bicubic                # [zimg] 缩放算法，可用值参考 --zimg-scaler-chroma
 zimg-scaler-param-a=1/3            # [zimg] 缩放算法的子参数
 zimg-scaler-param-b=1/3
 #zimg-dither=error-diffusion       # [zimg] <no|ordered|random 默认|error-diffusion> 色深抖动算法
 zimg-fast=no                       # [zimg] 以质量为代价优化性能，默认 yes


[NNEDI3+]
 profile-desc=适用于大多数场景
 glsl-shaders="~~/shaders/EDI/nnedi3_nns64_win8x4.glsl;~~/shaders/Adaptive_sharpen/Adaptive_sharpen_lite_luma_RT.glsl"

##############
# 条件配置组 #
##############

##⇘⇘条件触发配置，根据给定条件激发特定参数。简易格式见示例
##仅注释掉 --profile-cond 和 --profile-restore 即可将条件配置变为常规配置，常规配置的使用方法为通用区 --profile=<value>

##⇘⇘条件配置的格式示例
##[FS-loop]                                                  # 配置名称，自定义
##profile-desc    = 全屏时循环播放当前文件                   # 配置的描述，不属于参数，随意写
##profile-cond    = fullscreen                               # 触发该配置的条件。可用的属性列表 https://mpv.io/manual/master/#property-list
##profile-restore = copy                                     # 此参数一般用于回归触发前的通用参数（关闭此项将保留）
##...                                                        # 然后写该条件下触发的参数
##...

##⇘⇘文件名匹配的示例写法：根据文件名中的特定字符触发配置
##字符 "-" 需要使用 LUA 的转义符 "%"
#[VCB-Studio]
#profile-desc=真空断路器
#profile-cond=filename:find("VCB%-Studio")~=nil
#profile-restore=copy
#deband=no

[Deband]
 profile-desc=YUV420P10 以下的源开启去色带
 profile-cond=get("video-params/average-bpp") < 24
 profile-restore=copy
 deband=yes

[hdr-2390]
 profile-cond=p.tone_mapping == "bt.2390" and p.current_vo == "gpu-next"
 profile-restore=copy
 tone-mapping-param=2.0

#[hdr-spline]
#profile-cond=p.tone_mapping == "spline"
#profile-restore=copy
#tone-mapping-param=1.0

[peak-percentile]
 profile-cond=get("video-params/avg-pq-y") < 0.21 and p.current_vo == "gpu-next"
 profile-restore=copy
 hdr-peak-percentile=99.8

[SDR-gamut]
 profile-desc=SDR 内容的色域映射
 profile-cond=get("video-params/primaries") ~= "bt.709" and get("video-params/gamma") == "bt.1886"
 profile-restore=copy
 gamut-mapping-mode=clip

[SDR-target]
 profile-desc=SDR 显示目标配置
 profile-cond=not get("video-params/max-luma") and not get("inverse-tone-mapping") and p.current_vo == "gpu-next"
 profile-restore=copy
 target-colorspace-hint=no

#[RTX-HDR]
# 启用时需禁用上方的 [SDR-target] 条件配置组才能实际生效
# profile-desc=SDR 反向映射 HDR
# profile-cond=not get("video-params/max-luma") and get("video-target-params/max-luma") > 203 and p.current_vo == "gpu-next"
# profile-restore=copy
# inverse-tone-mapping=no
# target-colorspace-hint=auto
# vf-pre=d3d11vpp=nvidia-true-hdr

[HDR]
 profile-desc=HDR 配置
 profile-cond=get("video-params/max-luma") > 203
 profile-restore=copy
 target-peak=auto
 target-colorspace-hint=auto
 target-colorspace-hint-mode=target
 hdr-reference-white=100
 blend-subtitles=no
 deband=no
 vf=""

[HDR-PASS]
 profile-desc=HDR 直通参数，仅在 HDR 显示模式下生效
 profile-cond=get("video-params/max-luma") > 203 and get("video-target-params/max-luma") > 203 and p.current_vo == "gpu-next"
 profile-restore=copy
 icc-profile=""
 icc-profile-auto=no
 target-colorspace-hint=auto
 target-colorspace-hint-mode=target
 inverse-tone-mapping=no      # HDR 下不可启用反向映射功能
 target-prim=auto
 #target-gamut=dci-p3         # 或 adobe，用于 argb 色域
 target-trc=auto
 target-peak=auto             # 或可指定 HDR 显示器的峰值亮度值，默认值会自动获取此信息
 target-contrast=auto         # 或可指定 HDR 显示器的对比度值，默认值会自动获取此信息
 #sub-hdr-peak=100            # 用于调整 HDR 输出下的文本字幕亮度，越低的值越暗
 #image-subs-hdr-peak=10000   # 用于调整 HDR 输出下的图像字幕亮度，越高的值越暗，示例为最大值

[video-sync]
 profile-desc=当音频调整速度超过阈值时改变音视频同步模式，以避免明显的音高变化
 profile-cond=(speed * audio_speed_correction) > 0 and ((speed * audio_speed_correction) < 0.96 or (speed * audio_speed_correction) > 1.04) and not (get("estimated-vf-fps") > 47 or get("display-fps") > 120)
 profile-restore=copy-equal
 video-sync=display-tempo

[fps-fix]
 profile-desc=修复视频帧率和显示刷新率过高引起的异常耗能或掉帧
 profile-cond=get("estimated-vf-fps") > 47 or get("display-fps") > 120
 profile-restore=copy
 video-sync=audio

[8k-fix]
 profile-desc=8k av1 下使用 d3d11va 硬解来解决掉帧问题，该方案仅限 --gpu-api=d3d11 下可用
 profile-cond=get("video-params/w") > 7000 or get("video-params/h") > 3000
 profile-restore=copy
 hwdec=auto-safe
 video-sync=audio

[pgs-fix]
 profile-desc=修复国内电影压制的内封 pgs 字幕画幅比例与视频不一致导致的字幕错位
 profile-cond=get("video-params/aspect") > 16 / 9
 profile-restore=copy
 stretch-image-subs-to-screen=yes

#[deinterlace]
# profile-desc=自动去交错
# profile-cond=get("video-frame-info/interlaced")
# profile-restore=copy
# deinterlace

#[audio-filter]
#副作用：切换音频输出设备时会导致持续的音视频不同步
# profile-desc=音频通道大于 2 时开启动态范围调节滤镜，适用于双通道设备
# profile-cond=get("audio-params/channel-count") > 2
# profile-restore=copy-equal
# af-pre=@dynaudnorm:lavfi=[dynaudnorm=f=500:g=31:p=0.5:m=5:r=0.9]

[pause]
 profile-desc=暂停时取消置顶
 profile-cond=pause
 profile-restore=copy
 ontop=no

#[fullscreen]
# profile-desc=全屏自动置顶
# profile-cond=fullscreen or window_maximized
# profile-restore=copy
# ontop

[maximized]
 profile-desc=最大化时取消窗口大小自动调整
 profile-cond=window_maximized and vid and not get("current-tracks/video/albumart")
 profile-restore=copy-equal
 auto-window-resize=no

[minimized]
 profile-desc=最小化时暂停
 profile-cond=window_minimized and vid and not get("current-tracks/video/albumart")
 profile-restore=copy-equal
 pause

[end]
 profile-desc=播放列表结束后退出全屏
 profile-cond=idle_active
 no-fullscreen
 no-window-maximized

#[image]
# profile-desc=图像
# profile-cond=vid and not get("current-tracks/video/albumart") and estimated_frame_count <= 1
# profile-restore=copy
# prefetch-playlist
# image-display-duration=inf
# scale=ewa_hanning
# cscale=ewa_hanning
# dscale=mitchell

[audio]
 profile-desc=音乐
 profile-cond=aid and (not vid or get("current-tracks/video/albumart"))
 profile-restore=copy
 prefetch-playlist
 loop-playlist=inf
 script-opts=modernz-visibility=always
 watch-later-options=edition,volume,aid,vid,sid,secondary-sid
 glsl-shaders=" "